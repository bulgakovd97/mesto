(()=>{"use strict";var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{hi:()=>_,Fs:()=>f,lH:()=>k,xS:()=>m});const t=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__avatar-button"),i=document.querySelector(".popup__input_type_name"),n=document.querySelector(".popup__input_type_about"),o=(document.querySelector(".popup__input_type_avatar"),document.querySelector(".popup__input_type_title"),document.querySelector(".popup__input_type_link"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});class a{constructor({data:e,userId:t,handleCardClick:s,handleLikeClick:r,handleDeleteClick:i},n,o){this._data=e,this._title=e.name,this._image=e.link,this._owner=e.owner,this._userId=t,this._handleCardClick=s,this._handleLikeClick=r,this._handleDeleteClick=i,this._api=n,this._cardSelector=o}getCard(){return this._element=this._getTemplate(),this._cardTitle=this._element.querySelector(".card__title"),this._cardImage=this._element.querySelector(".card__image"),this._deleteButton=this._element.querySelector(".card__delete-button"),this._likeButton=this._element.querySelector(".card__like-button"),this._likeCounter=this._element.querySelector(".card__like-counter"),this._cardTitle.textContent=this._title,this._cardImage.src=this._image,this._cardImage.alt=this._title,this.setLikeCount(this._data),this.checkLike(),this._setEventListeners(),this._checkDeleteIcon(),this._element}_getTemplate(){return document.querySelector(this._cardSelector).content.firstElementChild.cloneNode(!0)}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleLikeClick(this)})),this._deleteButton.addEventListener("click",(()=>{this._handleDeleteClick(this._element)})),this._cardImage.addEventListener("click",(()=>{this._handleCardClick(this._data)}))}_checkDeleteIcon(){this._userId===this._owner._id&&this._deleteButton.classList.add("card__delete-button_visible")}setLikeCount(e){this._likeCounter.textContent=e.likes.length}addLikedClass(){this._likeButton.classList.add("card__like-button_active")}removeLikedClass(){this._likeButton.classList.remove("card__like-button_active")}_isLiked(){return this._data.likes.some((e=>e._id===this._userId))}checkLike(){this._isLiked()?this.addLikedClass():this.removeLikedClass()}getLikeButton(){return this._likeButton.classList.contains("card__like-button_active")}}function l(e){return new a({data:e,userId:m,handleCardClick:e=>{k.open(e)},handleLikeClick:e=>{e.getLikeButton()?(e.removeLikedClass(),_.deleteLike(e._data._id).then((t=>{e.setLikeCount(t)})).catch((e=>console.log("Невозможно убрать лайк - "+e)))):(e.addLikedClass(),_.putLike(e._data._id).then((t=>{e.setLikeCount(t)})).catch((e=>console.log("Невозможно поставить лайк - "+e))))},handleDeleteClick:t=>{f.open(),f.setSubmitAction((()=>{f.preremove(!0),_.removeCard(e._id).then((()=>{t.remove(),f.close()})).catch((e=>console.log("Ошибка удаления карточки - "+e)))})),f.preremove(!1)}},_,".card-template").getCard()}class h{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup__close-button")||e.target.classList.contains("popup_opened"))&&this.close()}))}}class u extends h{constructor(e,{handleFormSubmit:t}){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__input"),this._buttonElement=this._popup.querySelector(".popup__button")}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.close()}))}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}preload(e){this._buttonElement.textContent=e?"Сохранение...":"Сохранить"}}class c{constructor(e,t){this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=document.getElementById(t),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._errorList=Array.from(this._formElement.querySelectorAll(".popup__error"))}_showInputError(e,t){this._errorElement=this._formElement.querySelector(`.${e.id}-error`),e.classList.add(this._inputErrorClass),this._errorElement.textContent=t,this._errorElement.classList.add(this._errorClass)}_hideInputError(e){this._errorElement=this._formElement.querySelector(`.${e.id}-error`),e.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass),this._errorElement.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_toggleButtonState(e){this._hasInvalidInput(e)?this.disableSubmitButton():(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled"))}_setEventListeners(){this._toggleButtonState(this._inputList,this._buttonElement),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inputList,this._buttonElement)}))}))}disableSubmitButton(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}cleanErrors(){this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}const _=new class{constructor(e){this.url=e.url,this.headers=e.headers}_checkApiRequest(e){return e.ok?e.json():Promise.reject(new Error(`${e.status}`))}getUserInfo(){return fetch(`${this.url}/users/me`,{headers:this.headers}).then(this._checkApiRequest)}getInitialCards(){return fetch(`${this.url}/cards`,{headers:this.headers}).then(this._checkApiRequest)}getInitialData(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}setUserInfo(e,t){return fetch(`${this.url}/users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then(this._checkApiRequest)}changeAvatar(e){return fetch(`${this.url}/users/me/avatar`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then(this._checkApiRequest)}addCard(e,t){return fetch(`${this.url}/cards`,{method:"POST",headers:this.headers,body:JSON.stringify({name:e,link:t})}).then(this._checkApiRequest)}removeCard(e){return fetch(`${this.url}/cards/${e}`,{method:"DELETE",headers:this.headers}).then(this._checkApiRequest)}putLike(e){return fetch(`${this.url}/cards/likes/${e}`,{method:"PUT",headers:this.headers}).then(this._checkApiRequest)}deleteLike(e){return fetch(`${this.url}/cards/likes/${e}`,{method:"DELETE",headers:this.headers}).then(this._checkApiRequest)}}({url:"https://mesto.nomoreparties.co/v1/cohort-21",headers:{authorization:"0e96852d-62c6-41f3-9055-b88bc0850f61","Content-Type":"application/json"}}),d=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({renderer:e=>{const t=l(e);d.addItem(t)}},".elements"),p=new class{constructor({nameSelector:e,aboutSelector:t,avatarSelector:s}){this._profileName=document.querySelector(e),this._profileAbout=document.querySelector(t),this._profileAvatar=document.querySelector(s)}getUserInfo(){return{name:this._profileName.textContent,about:this._profileAbout.textContent}}setUserInfo(e){this._profileName.textContent=e.name,this._profileAbout.textContent=e.about,this.setUserAvatar(e)}setUserAvatar(e){this._profileAvatar.src=e.avatar}}({nameSelector:".profile__name",aboutSelector:".profile__about",avatarSelector:".profile__avatar"});let m=null;_.getInitialData().then((e=>{const[t,s]=e;m=t._id,p.setUserInfo(t),d.renderItems(s)})).catch((e=>console.log("Ошибка загрузки страницы - "+e)));const v=new u(".popup_type_edit",{handleFormSubmit:e=>{v.preload(!0),_.setUserInfo(e.name,e.about).then((e=>{p.setUserInfo(e)})).catch((e=>console.log("Невозможно изменить данные пользователя - "+e))),v.preload(!1)}}),b=new u(".popup_type_add",{handleFormSubmit:e=>{b.preload(!0),_.addCard(e.name,e.link).then((e=>{const t=l(e);d.addItem(t)})).catch((e=>console.log("Ошибка добавления новой карточки - "+e))),b.preload(!1)}}),E=new u(".popup_type_avatar",{handleFormSubmit:e=>{E.preload(!0),_.changeAvatar(e.avatar).then((e=>{p.setUserAvatar(e)})).catch((e=>console.log("Ошибка загрузки аватара - "+e))),E.preload(!1)}}),k=new class extends h{constructor(e){super(e),this._viewTitle=this._popup.querySelector(".popup__title"),this._viewImage=this._popup.querySelector(".popup__image")}open(e){super.open(),this._viewTitle.textContent=e.name,this._viewImage.src=e.link,this._viewImage.alt=e.name}}(".popup_type_view"),f=new class extends h{constructor(e){super(e),this._form=this._popup.querySelector(".popup__form"),this._buttonElement=this._popup.querySelector(".popup__button")}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleConfirmSubmit()}))}setSubmitAction(e){this._handleConfirmSubmit=e}preremove(e){this._buttonElement.textContent=e?"Удаление...":"Да"}}(".popup_type_confirm");s.addEventListener("click",(()=>{C.cleanErrors(),C.disableSubmitButton(),v.open();const e=p.getUserInfo();i.value=e.name,n.value=e.about})),t.addEventListener("click",(()=>{L.cleanErrors(),L.disableSubmitButton(),b.open()})),r.addEventListener("click",(()=>{S.cleanErrors(),S.disableSubmitButton(),E.open()})),v.setEventListeners(),b.setEventListeners(),E.setEventListeners(),f.setEventListeners(),k.setEventListeners();const L=new c(o,"add-form"),C=new c(o,"edit-form"),S=new c(o,"avatar-form");L.enableValidation(),C.enableValidation(),S.enableValidation()})();